# Tag example

```yaml
apiVersion: images.io/v1
kind: Tag
metadata:
  name: nginx
spec:
  from: docker.io/rmarasch/simple-web-server:latest
  cache: true
```

# Deployment using a tag

```yaml
---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    image-tag: "true"
  name: app 
  labels:
    app: app
spec:
  replicas: 1
  selector:
    matchLabels:
      app: app
  template:
    metadata:
      labels:
        app: app
    spec:
      containers:
      - name: app
        image: simple-web-server
        ports:
        - containerPort: 8080
```

# Example of integrated registry configuration

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: local-registry-hosting
  namespace: kube-public
data:
  localRegistryHosting.v1: |
    host: "localregistry.ddns.net"
    hostFromContainerRuntime: "localregistry.ddns.net"
    hostFromClusterNetwork: "localregistry.ddns.net"
```
# Exposing tagio (tag push and pull)

```
oc expose deployment tagger	\
	--type=LoadBalancer	\
	--name=tagio-external	\
	--port=8083		\
	--target-port=8083
```

# Exposing tagio service externally with a NodePort service.

```
apiVersion: v1
kind: Service
metadata:
  name: tagio-external
  namespace: tagger
spec:
  ports:
  - port: 8083
    protocol: TCP
    targetPort: 8083
  selector:
    app: tagger
  type: NodePort
```

# Deploying an ephemeral registry into the cluster

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: registry-certificates
  namespace: registry
type: Opaque
data:
  domain.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUZnekNDQTJ1Z0F3SUJBZ0lVYjMyRHJWblIyeEloS1d1N0g4Qm5teThDUjhNd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1VURUxNQWtHQTFVRUJoTUNUa3d4Q3pBSkJnTlZCQWdNQWs1SU1SSXdFQVlEVlFRSERBbElhV3gyWlhKegpkVzB4RGpBTUJnTlZCQW9NQlV4dlkyRnNNUkV3RHdZRFZRUUREQWh5WldkcGMzUnllVEFlRncweU1ERXhNREV4Ck5USXdNamxhRncweU1URXhNREV4TlRJd01qbGFNRkV4Q3pBSkJnTlZCQVlUQWs1TU1Rc3dDUVlEVlFRSURBSk8KU0RFU01CQUdBMVVFQnd3SlNHbHNkbVZ5YzNWdE1RNHdEQVlEVlFRS0RBVk1iMk5oYkRFUk1BOEdBMVVFQXd3SQpjbVZuYVhOMGNua3dnZ0lpTUEwR0NTcUdTSWIzRFFFQkFRVUFBNElDRHdBd2dnSUtBb0lDQVFDNVo4KzRGeE5XCjU1ZU9QTmMyUzhlQlFDaFRrSGkrSkNrellVdGM1N3N1MDNlMXRyTVZ4LzBWN0dIOExhNmk3REtVSE0xQmVYV2wKQjlhZXh1VFBETURsdXV1SEJQTmVpNXJHZDVhaEZRaTZoekhhcWgxMFZDd0Q0VXZYZEU4Wm9rSVMzekhiTDNnKwpqWEZnSDBIdDAwQk42UVVRNXhQUHJOek1TeTE0RUVhblljNmNKRDVUK3gzc1JveHFCeUFVekpGN21SUGdaWVh5ClpwU0NLNnY5bVd0RzBEbTVJVllHTlRjSFBBcXZLbkEzd2djSGNaQUxOS3BjQzhSaWFLNEFCN2NpRXY3UGdkamwKN3gxK2s3VUFrUG5qRmtRQWt6TjhubTdNV3RHN2RKM1RPL21Wd3RMMjRvaXd3WXZxZC8yMm4xYjdWazRPWlBFcgpBSkIxSkY0VkRyM2tjaUF1ekpHeXloQXgzVUxTRHp4dStKSFNDVGVEZFdaREJlT3Q0RnBsNzFzVmpzeFF5NmVMCmEyVFBMNy81M05pSUhnQTNRTnhvd05KWHY4Mzl2NTBrQWFYczhMN281cjBPbGpaY05DNW91VVdpd2lzZi9ESksKOXR6VXk4V0l2cFN2STJ1ZHdPVnFxQkN1YXpLeURqemJ3UzhmZ2NyUHpQRkpUZlhHVk5jQnJONWhabmdrUFRhRApXaXB3SW1MeDBTU3JHUllsdlNUbHRXTWhrOWRJNmw3WVdFaTJZVXVndExsUXVYSmNvYmxkNEI1ZXhWL1dVOGZHClFqUlNuTW8rL1l4dDgxZFRZUTgwdnRwL0dxZjNWS2xBT2QwM2VwdE55Tk14WmNWV20veTEwMTBINy9KU1RvdmgKY054YjE0OGZzSjJrR0tiQk1LT2JDeUtUaGRZRlpDV1hDd0lEQVFBQm8xTXdVVEFkQmdOVkhRNEVGZ1FVZmJTYgp1TUJwQVpoWjlRWEhWNVNadFlxeHo4TXdId1lEVlIwakJCZ3dGb0FVZmJTYnVNQnBBWmhaOVFYSFY1U1p0WXF4Cno4TXdEd1lEVlIwVEFRSC9CQVV3QXdFQi96QU5CZ2txaGtpRzl3MEJBUXNGQUFPQ0FnRUFZaTZDU1NSTVRrTTYKaHp1TVZtdmVqNDRTdUFFSG5BRWRvRkR1TzEyOFpCdjM0RGEzejNOY3dVU2cyZ0pUa3IvRUdsdm5pS01qdTB1WQppWDN6VzF3Y09NNzRHYzZ1ZEFxcU8raWI0eVJkYmlnRTcyYks1VE1NQW5UZVJybjlzS3RuUU9GdlZXL3g2MThwClFtSGNCdEVVZ2daWHdtN0NsZk5XTDRYWk1NeWFjNmVJK1ZRL1pyTTUrVzZwMW1TMkJnTlE1OG9NV0p1ZEdBZkkKTnJLR2dNMDZVOTJUaU5pbklXd0J1Y3VGVUVkTmtlZDBtNW9iN25LTzlrS1lYd1EzazVZUHBhdnQyOXN3SDI5Mgp6a1c1WFMvY1N0OHk0L3JseUVzWlEvdlJaS2REdG9Jek9CaHRjV3BhY3JBczdKY0ZNUWlJeXVtcWJGV25VZE80CkNpSzdyZjVNeHZ2R3RxbEp6VDhrVE00V3doNGtCaFp4eU5uNndDOG1LSjNzSVUvNVVBamxQdVQvOWU0Y05GbWYKalRiUStFbkVHaHdzRitlUFI2cUZrL0JGQVJQTVlNa1ZEUDdsb0ZOU1V0VUVtT0s0a0s0K2RSRTNETXhIK0NoWQp2N25IY0EwejVUTi8zKzhQTnJaek10Q0NuME9oMm1RQlRxMUVqR3JIY25sR1psK1NYWHZwK3pxVkUvUXRDaWxhCnc2OFNWWlZldXlSaHhSWE1udGNOc0ZvNVpmaU14RGZkZW1uWG1vRituVFVJckdrUlFkV0tSMDJNQU43Rkl0SlgKZExlaDR1Tmdaei9zV3d5ci9WbVdnOGJ2bjh5MmpYRGtHYzErVmNxVVdHWm5YUTM3b1dtWTdwNzdmSXVRd1pUUgoxYW5mZWFNOEd6NHpEdXZPVldFVXlnN3BlaXRiSXZJPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
  domain.key: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUpRd0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQ1Mwd2dna3BBZ0VBQW9JQ0FRQzVaOCs0RnhOVzU1ZU8KUE5jMlM4ZUJRQ2hUa0hpK0pDa3pZVXRjNTdzdTAzZTF0ck1WeC8wVjdHSDhMYTZpN0RLVUhNMUJlWFdsQjlhZQp4dVRQRE1EbHV1dUhCUE5laTVyR2Q1YWhGUWk2aHpIYXFoMTBWQ3dENFV2WGRFOFpva0lTM3pIYkwzZytqWEZnCkgwSHQwMEJONlFVUTV4UFByTnpNU3kxNEVFYW5ZYzZjSkQ1VCt4M3NSb3hxQnlBVXpKRjdtUlBnWllYeVpwU0MKSzZ2OW1XdEcwRG01SVZZR05UY0hQQXF2S25BM3dnY0hjWkFMTktwY0M4UmlhSzRBQjdjaUV2N1BnZGpsN3gxKwprN1VBa1BuakZrUUFrek44bm03TVd0RzdkSjNUTy9tVnd0TDI0b2l3d1l2cWQvMjJuMWI3Vms0T1pQRXJBSkIxCkpGNFZEcjNrY2lBdXpKR3l5aEF4M1VMU0R6eHUrSkhTQ1RlRGRXWkRCZU90NEZwbDcxc1Zqc3hReTZlTGEyVFAKTDcvNTNOaUlIZ0EzUU54b3dOSlh2ODM5djUwa0FhWHM4TDdvNXIwT2xqWmNOQzVvdVVXaXdpc2YvREpLOXR6VQp5OFdJdnBTdkkydWR3T1ZxcUJDdWF6S3lEanpid1M4ZmdjclB6UEZKVGZYR1ZOY0JyTjVoWm5na1BUYURXaXB3CkltTHgwU1NyR1JZbHZTVGx0V01oazlkSTZsN1lXRWkyWVV1Z3RMbFF1WEpjb2JsZDRCNWV4Vi9XVThmR1FqUlMKbk1vKy9ZeHQ4MWRUWVE4MHZ0cC9HcWYzVktsQU9kMDNlcHROeU5NeFpjVldtL3kxMDEwSDcvSlNUb3ZoY054YgoxNDhmc0oya0dLYkJNS09iQ3lLVGhkWUZaQ1dYQ3dJREFRQUJBb0lDQUdBaUNKMCtNY1Brenp0c0puYTdzaFU5CmErdHdSSHJxaXdaZUUxSjN3U0dWZWtPWkdLQlprc3VVUm5ZWVJhMnFaTXRSWjhma0wzRERjSy9oRnZDWWYwaGUKdEJMTktWZERjWndvazh5ditGZW5FOTE2U1UxdysyV0RvdXh6SFRTQVlsd2dxRndxNytFWE84c0lTZ29EZUJzdAprSGZrS095TWgrdlJxeURPNTZPUVhpMnR5VGVJUkVxbmhkVFFIdjFKMk1GS2JQajBDeERWeVhqNUpmT1hZZjFVCnFDbHF0STBCZUtmaXBQT1FRS0ZZbElaeWhxcVl3eUI0NVhuVkp5dFMxTXp4Sm5mM3Jyd0NVTHU1NEtjTGhOWVAKVEhFejRnVmlyTForL0xLQzAvYWI2VnlTcVFwa0NWWUU5UVE4OVN1RTBQZi9GdmYxdE9xRUgyTHQyVzUzdDFOagpKTWt5RTBtM1czWkkrZzlRTlJSUUhwb3B1NWNHMXRvY3g1b2NlSG1QMHRGV1I3ODVrTE00bzRCeElwcnRTeERkCjAxZEtMYXhCV0FTcDJNMk0ycDJxZXpxOXE4eE5jNWtSbnNuR3NxWHEzR0NKdHBaVE5vRlFheldOMmpRVzQ4c2sKa1ByV2JEa29BeXFMMnFlTnBaL1RqVWZBUnh5eWdLbSs5VWwrR0RERWlPMmRmeUI3MVdML1U0d3VFRGQzMlRuSwp6eUZvK2pZd3pyeGhLZW5ZNGFlY0dkQTE4eGFpUTh2VVF5MDh0YVozcFlpUmxDRkFOWFNoRS9HZEpMMTVKSEtVClpuVFVadWlrblYrVzF6RlEyMVhRejR5VGNSUVM3MnFOaDFpNzVGZHZWelBXVndPb29wZ25KKzFjeU94b2xNN0kKY0NBUUZoWDVORDFDR1ZMdEs1U0JBb0lCQVFEZ3JZMUlVQ2xRUUI2NXoyOURMbVd1L3pQR0R5SVVVTHRTMU53QQpSZDZDdzM4R2EvSFM4NXlhVGVlWlp2NnRKN0NvZmNJVzBLdkFTNG9ub2JSTk5rMlJpaXZUYmxVSThvc3RzUDk5CmZuRlF6Q1kzUEN2RnhNbjFhSVdKQnd5aDFQYThsMVd2V0RUdkFhSHI1M3RjZWlXWWI5M3Z1OWh6TU0rL0hrYXAKMk9BenhCR3Btd3RBR3dLZUhLeEhZUnhUSEwzcVBSSkxDL0ZKMlF6SUQySktEc29qWlYyQjgzcUo4WDlMYzI4cwppbE1EM0NzdGFsV0RRbzlYRWU0Q0RqYWZ3UjBuZEdhZXFibVFJa2IwSmlDQzI1Sk5wZGZoRzRXL200cVVEaW5LCkgyUlVwMDMwemxPeFo5dDVlWVVYZ2UvT3JlQnJFMmYxenpVbCthdnF2R1EvR2RKTEFvSUJBUURUUUs0eVhwSzYKMDV4WVU1MU5HbEhYbXRBS3YzSkdIMGRwQ09CcUp1a3B4QnhLbTQ4UVZEQ1BaQTVNTzBESVhCUmtTekN1QVVzZAp2V29OdnlqT2FKaTZzeGg1b3A1ekFMTGdRUDNXek16dUFYcjlkMVBKSDZ1TWNobzdLTmhNNzFGSFhFQzRZaGtkCnJ0VXRmZ0tCdDZRZlVsemwrQTZCR3RMZFNCZkM2Q1FpYmtYR2JQOWFJakdwOGtWa09xWUZ3Ri8zQ2hwbC9tbWMKNmxCMml4TUg2empINnlnOHRycTBjbHNnOXVoMHp0Ukc3VmxHb3NVdCtpY1NQcDNDNkp5c2xOZVM5a3l4alo2Mgo4ekRrMklVU1pFMHlqQ1Y0WWtwNUdIT0VBY2s5RXk1bjN1T01KaHlPR2drS3ZVYXQ3R2dqelNqaUFxR21IMVdpCnFwdUxPdHd1bGxaQkFvSUJBRktJTGgva0ltanlSTmNvbGN4dDNMaGQwcHpzcmk0Y1FkTjVrWjhnQzA2cGxaMjgKUlVhaWFtSmNQN2tnRm1sdzdQblh5Rll0TFFva05ZbTlZc2dDTEpoTDB6R0ZsQU1IWll6Uk9lalZhN2FzWjFWZQo2dzFvN204UmlBdi81T29GbXVWSUNoZXhKVEN1dnRZellDTm1VeTBkMnI3WGwva29jd2ZYalVtUyt6akl5MXdzCk1nUElhRHZBZUtCMzBibk9FdzFhaGIrL2tWRDVSREt4US8vRVV3aVJrYm5Nd0xTdlczMVIyQUxhaFFnajlsQm0KZ1NjSWFqTW55UEJFWEZodXpkRFNkMmZOSFBjUFFGVXJORUlkZWk2L3Z2OVg1dGV0d1VnRnMrQWxpK3QwMGJRZApucXpLWTlySmd0UlJ6TTkxRzd6NWtmUy91dHhLVEphYndZOVVZdVVDZ2dFQkFKWUdJeSttTmpIendkNkFVdi9FCnAwYWtyUVpVKzRTTkJodXpzQnZ5MGpkVkRIcDNpdHdmemZTbksvZzdSRUNHRS8wOTRLNVNRTlE0Qmk4SkNLTzkKYUdsK2N1MCs3YVBpWlNZWlFhdmYrZEUwdi9GdFl0VThab254Sm12SkVBTmpHYWZCL2p4emZqNjBRTFJ6L3JlOApnUk8xWEQvOUw5L0QrdWduSUtqTVQ0MGNIdlZSeHU1dHhqTlkyS3JiYzdnMTdIRDJmZFRkSG9mUFo2RW9GelhTCmVKcVJpQnZGOFVYZ3lKTGFoaThlQzJicmZERkx1eGh4eEhtU2VsdEc4cTBsYndyeFczbmtoMGlKNExsRWd3eVMKcXJneEN4TTVTb1pCTlJnVVpLTzVFWVcycG9hTE1sQkFjUmR0WDlwNFAyVGRlQ0U1bVM3dXBkUkZzUHpwcWlCegpwNEVDZ2dFQkFLck5vdkV4QkVjbDIvSTd2ZXdJeXFXdjZPVHFBMTlaamZyZlZ3OE9yVlhBdGVnSEZnUnRqbjdMCms3bE50L0orSDhXRDFBTHFCVE5jM1VPZmNqUkF6SnJSRDdEUWptcWZjSDVFcDl5RkdLaE5zVmpYR2p3blkzaGYKK0pMc2ZnSEpRdVFuVlRHN0UwdlhNSnJsQVg1OG9RYmpXVUVNOTlPVlZtcnR2bkFTa0VTMXZ3MC9sOHhQLzJKbQpoeStMNXZtTFhDMzZmMy8rakNFYkhDM0VXS05oejI0Vm9SS2F1d0RBN1E3OHM1Z1p6WEIwdm9VM2xBTnc5dHVvCmNTSUk1VzY4TUo1ajBHdnRyQzBJRDlWYUFNaC9ZWTZqREdUTTZvSldYL2gvcXVncGI0c0RPV3BjMWdlWUVSRXMKV3JJY09JeEM3SFlLNkV3UU1zUXBUZnBNbHoyT0JtVT0KLS0tLS1FTkQgUFJJVkFURSBLRVktLS0tLQo=
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: registry
  namespace: registry
  labels:
    app: registry
spec:
  replicas: 1
  selector:
    matchLabels:
      app: registry
  template:
    metadata:
      labels:
        app: registry
    spec:
      containers:
      - name: registry
        image: docker.io/library/registry:2
        env:
        - name: REGISTRY_HTTP_TLS_CERTIFICATE
          value: /certs/domain.crt
        - name: REGISTRY_HTTP_TLS_KEY
          value: /certs/domain.key
        volumeMounts:
          - name: registry-certificates
            mountPath: /certs
        ports:
        - containerPort: 5000
      volumes:
      - name: registry-certificates
        secret:
          secretName: registry-certificates
---
apiVersion: v1
kind: Service
metadata:
  name: local
  namespace: registry
spec:
  type: ClusterIP
  selector:
    app: registry
  ports:
    - protocol: TCP
      port: 5000 
      targetPort: 5000
```

